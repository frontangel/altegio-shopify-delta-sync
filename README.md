# üõí Altegio ‚Üí Shopify Sync Service

–¶–µ–π –ø—Ä–æ—î–∫—Ç –ø—Ä–∏–π–º–∞—î –≤–µ–±—Ö—É–∫–∏ –∑ [Altegio](https://altegio.com/) —Ç–∞ –æ–Ω–æ–≤–ª—é—î –∑–∞–ª–∏—à–∫–∏ —Ç–æ–≤–∞—Ä—ñ–≤ —É [Shopify](https://shopify.com) –∑–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º SKU.

---

## ‚öôÔ∏è –û–ø–∏—Å

–¶–µ –º—ñ–Ω—ñ–º–∞–ª—ñ—Å—Ç–∏—á–Ω–∏–π Node.js —Å–µ—Ä–≤—ñ—Å, —è–∫–∏–π:

- ‚úÖ –ü—Ä–∏–π–º–∞—î webhook'–∏ —Ç–∏–ø—É `goods_operations_sale` –∑ Altegio
- ‚úÖ –í–∏–∑–Ω–∞—á–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —Ç–æ–≤–∞—Ä —É Shopify –∑–∞ –∞—Ä—Ç–∏–∫—É–ª–æ–º (SKU)
- ‚úÖ –û–Ω–æ–≤–ª—é—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—É –≤ Shopify —á–µ—Ä–µ–∑ GraphQL API
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ª–æ–∫–∞–ª—å–Ω–µ –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –±–µ–∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- ‚úÖ –ú–∞—î **–ø—Ä–∏–º—ñ—Ç–∏–≤–Ω—É —á–µ—Ä–≥—É** –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è Shopify API rate-limit
- ‚úÖ –ü—Ä–∞—Ü—é—î –∑ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–∏–º `LocationId`, –ø–µ—Ä–µ–¥–∞–Ω–∏–º —á–µ—Ä–µ–∑ `.env`

---

## üì¶ –°—Ç–µ–∫

- Node.js + Express
- `graphql-request` –¥–ª—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ Shopify
- `dotenv` –¥–ª—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- –ü—Ä–æ—Å—Ç–∏–π `queue.service.js` –Ω–∞ `setInterval` –±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫
- –ö–µ—à—É–≤–∞–Ω–Ω—è –≤ –ø–∞–º º—è—Ç—ñ (—á–µ—Ä–µ–∑ `CacheManager`)

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É
```
.
‚îú‚îÄ‚îÄ .env                  # –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
‚îú‚îÄ‚îÄ index.js              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ shopify.service.js      # Shopify API –∑–∞–ø–∏—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ queue.service.js        # –ß–µ—Ä–≥–∞ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é —á–∞—Å—Ç–æ—Ç–∏ –∑–∞–ø–∏—Ç—ñ–≤
‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îú‚îÄ‚îÄ useStore.js             # –ê–ª–≥–æ—Ä–∏—Ç–º –º–∞–ø—ñ–Ω–≥—É SKU
‚îÇ   ‚îî‚îÄ‚îÄ cache.manager.js        # –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –∫–µ—à —É –ø–∞–º º—è—Ç—ñ
```

---

## üß™ –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
npm install
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `.env`

```env
SF_API_VERSION=2025-04
SF_DOMAIN=your-store.myshopify.com
SF_ADMIN_ACCESS_TOKEN=shpat_xxxxx
SF_CONST_LOCATION_ID=gid://shopify/Location/123456789
PORT=3000
```

### 3. –ó–∞–ø—É—Å–∫

```bash
npm start
```

---

## üîÑ Webhook

–û—á—ñ–∫—É—î—Ç—å—Å—è POST-–∑–∞–ø–∏—Ç –≤—ñ–¥ Altegio –Ω–∞:

```
POST /webhook
```

–ü—Ä–∏–∫–ª–∞–¥ —Ç—ñ–ª–∞ –∑–∞–ø–∏—Ç—É:
```json
{
  "resource": "goods_operations_sale",
  "company_id": 12345,
  "data": {
    "good": { "id": 678 },
    "amount": -2
  }
}
```

---

## üîÅ –ß–µ—Ä–≥–∞

–ó–∞–≤–¥–∞–Ω–Ω—è (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–Ω–æ–≤–∏—Ç–∏ –∑–∞–ª–∏—à–æ–∫) –Ω–µ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –æ–¥—Ä–∞–∑—É, –∞ —Å—Ç–∞–≤–ª—è—Ç—å—Å—è –≤ —á–µ—Ä–≥—É (`queue.service.js`) —ñ –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è **–ø–æ –æ–¥–Ω–æ–º—É –∫–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É** –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è Shopify Throttle (`Throttled`).

---

## üì• –ï–Ω–¥–ø–æ—ñ–Ω—Ç–∏

- `GET /sku?sku=123456` ‚Äì –æ—Ç—Ä–∏–º–∞—î inventoryItemId –∑–∞ SKU
- `GET /db` ‚Äì –≤—ñ–¥–¥–∞—î –ø–æ—Ç–æ—á–Ω–∏–π –∫–µ—à SKU ‚Üî inventoryID
- `POST /webhook` ‚Äì –≥–æ–ª–æ–≤–Ω–∞ —Ç–æ—á–∫–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó –∑ Altegio

---

## üõë –û–±–º–µ–∂–µ–Ω–Ω—è

- –ù–µ–º–∞—î –±–∞–∑–∏ –¥–∞–Ω–∏—Ö (—Ç—ñ–ª—å–∫–∏ –∫–µ—à —É –ø–∞–º º—è—Ç—ñ)
- –ü—Ä–∏–º—ñ—Ç–∏–≤–Ω–∞ —á–µ—Ä–≥–∞ –±–µ–∑ retry-–ª–æ–≥—ñ–∫–∏
- –ü—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ –∑ –æ–¥–Ω–∏–º `LocationId`

---

## üîê –ë–µ–∑–ø–µ–∫–∞

### üîê Basic Auth –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö endpoint'—ñ–≤

–ú–∞—Ä—à—Ä—É—Ç–∏ `/db` —ñ `/sku` –∑–∞—Ö–∏—â–µ–Ω—ñ –±–∞–∑–æ–≤–æ—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—î—é (Basic Auth).

–£ `.env` –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∫–∞–∑–∞—Ç–∏:

```env
BASIC_AUTH_USER=admin
BASIC_AUTH_PASS=mystrongpassword
```

–¢–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø–∏—Ç:

```bash
curl -u admin:mystrongpassword https://your-app.up.railway.app/db
```

---

## üìå –ü–ª–∞–Ω–∏ –Ω–∞ –º–∞–π–±—É—Ç–Ω—î

- –î–æ–¥–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–µ—à—É —É Redis –∞–±–æ MongoDB
- –†–æ–∑—à–∏—Ä–∏—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É —ñ–Ω—à–∏—Ö —Ç–∏–ø—ñ–≤ webhook'—ñ–≤
- –î–æ–¥–∞—Ç–∏ retry –¥–ª—è –ø–æ–º–∏–ª–æ–∫ —Ç–∏–ø—É `Throttled` —á–∏ `5xx`
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∫—ñ–ª—å–∫–æ—Ö –∫–æ–º–ø–∞–Ω—ñ–π / –ª–æ–∫–∞—Ü—ñ–π (multi-tenant)

---



## üë§ –ê–≤—Ç–æ—Ä
–†–æ–∑—Ä–æ–±–ª–µ–Ω–æ **Frontangel**.  
–ó–∞–ø–∏—Ç–∞–Ω–Ω—è —á–∏ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó? –ù–∞–ø–∏—à–∏ –≤ [Telegram](https://t.me/frontangel) –∞–±–æ [GitHub Issues](https://github.com/frontangel/altegio-shopify-delta-sync/issues).
